<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Job Application Helper</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  </head>
<body>
  <!-- Grid principal -->
  <div class="main-container">
    <!-- COLUMNA IZQUIERDA -->
    <div class="left-column">
      <!-- 1. InformaciÃ³n de la oferta -->
      <div class="modern-card">
        <h2 class="card-title">
          <i class="fas fa-briefcase"></i> InformaciÃ³n de la oferta
        </h2>
        <textarea
          class="modern-textarea"
          rows="10"
          [(ngModel)]="offerText"
          placeholder="âœ¨ Pega aquÃ­ la descripciÃ³n completa de la oferta de trabajo que te interesa..."
        ></textarea>
      </div>

      <!-- 2. Cargar CV + idioma/tono -->
      <div class="modern-card">
        <h2 class="card-title">
          <i class="fas fa-cloud-upload-alt"></i> Cargar CV
        </h2>

        <!-- Zona arrastrar/soltar -->
        <label class="upload-zone">
          <input type="file" accept=".pdf" (change)="onCv($event)" />
          <i class="fas fa-cloud-upload-alt upload-icon"></i>
          <div class="upload-text">
            <strong>Arrastra tu CV aquÃ­</strong> o haz clic para seleccionar
            <br><small>Solo archivos PDF</small>
          </div>
        </label>

        <div *ngIf="cvName" class="file-uploaded">
          <i class="fas fa-check-circle"></i>
          <span>{{ cvName }}</span>
        </div>

        <!-- Selectores -->
        <div class="form-grid">
          <div class="modern-select">
            <label>Idioma</label>
            <select [(ngModel)]="language">
              <option value="es">ðŸ‡ªðŸ‡¸ EspaÃ±ol</option>
              <option value="en">ðŸ‡ºðŸ‡¸ InglÃ©s</option>
              <option value="fr">ðŸ‡«ðŸ‡· FrancÃ©s</option>
            </select>
          </div>

          <div class="modern-select">
            <label>Tono</label>
            <select [(ngModel)]="tone">
              <option value="formal">Formal</option>
              <option value="profesional">Profesional</option>
              <option value="cercano">Cercano</option>
            </select>
          </div>
        </div>
      </div>

      <!-- 3. Botones de acciÃ³n -->
      <div class="modern-card">
        <div class="button-container">
          <button
            class="modern-button primary"
            (click)="generateCv()"
            [disabled]="!cvName || generatingCv"
            [class.loading]="generatingCv"
          >
            <i class="fas fa-file-alt"></i>
            <span *ngIf="!generatingCv">Generar CV adaptado</span>
            <span *ngIf="generatingCv">Generando CV...</span>
          </button>

          <button
            class="modern-button secondary"
            (click)="generateLetter()"
            [disabled]="!offerText || generatingLetter"
            [class.loading]="generatingLetter"
          >
            <i class="fas fa-envelope"></i>
            <span *ngIf="!generatingLetter">Generar carta de presentaciÃ³n</span>
            <span *ngIf="generatingLetter">Generando carta...</span>
          </button>
        </div>
      </div>

      <!-- 4. Resultados -->
      <div *ngIf="generatedCvText || generatedLetter" class="result-container">
        <div *ngIf="generatedCvText" class="result-card">
          <h3 class="result-title">
            <i class="fas fa-file-alt"></i> CV Adaptado
          </h3>
          <textarea readonly class="result-textarea">{{ generatedCvText }}</textarea>
        </div>

        <div *ngIf="generatedLetter" class="result-card">
          <h3 class="result-title">
            <i class="fas fa-envelope"></i> Carta de PresentaciÃ³n
          </h3>
          <textarea readonly class="result-textarea">{{ generatedLetter }}</textarea>
        </div>
      </div>
    </div>

    <!-- COLUMNA DERECHA (CHAT) -->
    <div class="chat-container">
      <h2 class="card-title">
        <i class="fas fa-comments"></i>
        Entrevista Simulada
      </h2>

      <!-- Controles -->
      <div class="chat-controls">
        <div class="chat-select">
          <label>Nivel</label>
          <select [(ngModel)]="level">
            <option value="principiante">Principiante</option>
            <option value="medio">Medio</option>
            <option value="avanzado">Avanzado</option>
          </select>
        </div>

        <button
          class="chat-button start"
          (click)="startInterview()"
          [disabled]="interviewActive || !parsedCv || !offerText || interviewLoading"
        >
          <i class="fas fa-play"></i>
          <span *ngIf="!interviewLoading">Iniciar</span>
          <span *ngIf="interviewLoading">Preparando...</span>
        </button>

        <button
          class="chat-button stop"
          (click)="endInterview()"
          [disabled]="!interviewActive"
        >
          <i class="fas fa-stop"></i>
          Terminar
        </button>
      </div>

      <!-- Ventana de chat -->
      <div class="chat-window" #chatWindow>
        <div
          *ngFor="let m of chat"
          class="chat-message"
          [class.user]="m.from === 'user'"
          [class.bot]="m.from === 'bot'"
        >
          <div
            class="message-bubble"
            [class.user]="m.from === 'user'"
            [class.bot]="m.from === 'bot'"
          >
            {{ m.text }}
          </div>
        </div>
      </div>

      <!-- Input -->
      <form (submit)="sendMsg()" class="chat-input-container">
        <input
          class="chat-input"
          placeholder="ðŸ’¬ Escribe tu respuesta aquÃ­..."
          [(ngModel)]="chatInput"
          name="msg"
        />
        <button
          type="submit"
          class="send-button"
          [disabled]="!chatInput.trim()"
        >
          <i class="fas fa-paper-plane"></i>
        </button>
      </form>

      <!-- Feedback -->
      <div *ngIf="lastFeedback" class="feedback-container">
        <i class="fas fa-info-circle"></i>
        <strong>Feedback:</strong> {{ lastFeedback }}
        <span *ngIf="lastScore !== null">
          â€“ PuntuaciÃ³n: {{ lastScore | number : "1.0-2" }}
        </span>
      </div>
    </div>
  </div>
</body>
</html>