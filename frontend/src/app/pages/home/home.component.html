<!-- Grid principal -->
<div class="main-grid">
  <!-- COLUMNA IZQUIERDA  -->
  <div class="left-column">
    <!-- 1. InformaciÃ³n de la oferta -->
    <mat-card appearance="outlined" class="offer-card">
      <h2 class="card-title">
        <mat-icon>work</mat-icon> InformaciÃ³n de la oferta
      </h2>
      <textarea
        matInput
        rows="10"
        [(ngModel)]="offerText"
        placeholder="âœ¨ Pega aquÃ­ la descripciÃ³n completa de la oferta de trabajo que te interesa..."
        class="w-full mt-2"
      ></textarea>
    </mat-card>

    <!-- 2. Cargar CV + idioma/tono -->
    <mat-card appearance="outlined" class="upload-card space-y-4">
      <h2 class="card-title"><mat-icon>upload</mat-icon> Cargar CV</h2>

      <!-- Contenedor flex horizontal -->
      <div class="upload-card-content">
        <!-- SecciÃ³n izquierda: zona de carga -->
        <div class="upload-section">
          <!-- Zona arrastrar/soltar -->
          <label class="upload-dropzone">
            <input type="file" accept=".pdf" hidden (change)="onCv($event)" />
            <mat-icon class="upload-icon text-4xl mb-2">cloud_upload</mat-icon>
            <span
              ><strong>Arrastra tu CV aquÃ­</strong> o haz clic para
              seleccionar<br /><small>Solo archivos PDF</small></span
            >
          </label>

          <p
            *ngIf="cvName"
            class="upload-ok text-green-700 flex items-center gap-1"
          >
            <mat-icon>check_circle</mat-icon> {{ cvName }}
          </p>
        </div>

        <!-- SecciÃ³n derecha: selectores apilados -->
        <div class="selectors-section">
          <mat-form-field appearance="fill">
            <mat-label>Idioma</mat-label>
            <mat-select [(ngModel)]="language">
              <mat-option value="es">ðŸ‡ªðŸ‡¸ EspaÃ±ol</mat-option>
              <mat-option value="en">ðŸ‡ºðŸ‡¸ InglÃ©s</mat-option>
              <mat-option value="fr">ðŸ‡«ðŸ‡· FrancÃ©s</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Tono</mat-label>
            <mat-select [(ngModel)]="tone">
              <mat-option value="formal">Formal</mat-option>
              <mat-option value="profesional">Profesional</mat-option>
              <mat-option value="cercano">Cercano</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
    </mat-card>

    <!-- 3. Botones de acciÃ³n -->
    <mat-card
      appearance="outlined"
      class="actions flex flex-wrap gap-4 mt-auto flex-grow"
    >
      <div class="button-container">
        <button
          mat-raised-button
          color="primary"
          (click)="generateCv()"
          [disabled]="generatingCv"
          [class.loading]="generatingCv"
        >
          <mat-icon>description</mat-icon>
          <span *ngIf="!generatingCv">Generar CV adaptado</span>
          <span *ngIf="generatingCv">Generando CVâ€¦</span>
        </button>

        <button
          mat-raised-button
          color="accent"
          (click)="generateLetter()"
          [disabled]="generatingLetter"
          [class.loading]="generatingLetter"
        >
          <mat-icon>drafts</mat-icon>
          <span *ngIf="!generatingLetter">Generar carta</span>
          <span *ngIf="generatingLetter">Generando cartaâ€¦</span>
        </button>
      </div>
    </mat-card>
  </div>

  <!-- COLUMNA DERECHA (CHAT) -->
  <mat-card
    id="interview-section"
    appearance="outlined"
    class="interview-card flex flex-col lg:min-w-[360px]"
  >
    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TÃTULO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <h2 class="card-title">
      <mat-icon>chat</mat-icon>
      Entrevista simulada
    </h2>

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CONTROLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="chat-controls flex flex-wrap lg:flex-nowrap items-center gap-4">
      <!-- selector nivel -->
      <mat-form-field appearance="fill" class="min-w-[160px] flex-shrink-0">
        <mat-label>Nivel</mat-label>
        <mat-select [(ngModel)]="level">
          <mat-option value="principiante"> Principiante</mat-option>
          <mat-option value="medio"> Medio</mat-option>
          <mat-option value="avanzado"> Avanzado</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- botÃ³n iniciar -->
      <button
        mat-stroked-button
        color="primary"
        (click)="startInterview()"
        [disabled]="interviewLoading"
      >
        <mat-icon>play_arrow</mat-icon>
        <ng-container *ngIf="!interviewLoading">Iniciar</ng-container>
        <ng-container *ngIf="interviewLoading">Iniciandoâ€¦</ng-container>
      </button>

      <!-- botÃ³n terminar -->
      <button
        mat-stroked-button
        color="warn"
        (click)="endInterview()"
        [disabled]="!interviewActive"
      >
        <mat-icon>stop</mat-icon>
        Terminar
      </button>
    </div>

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ LISTA MENSAJES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div
      #chatWindow
      class="chat-window flex-1 border rounded my-4 p-2 space-y-2 bg-slate-50 overflow-y-auto"
    >
      <div
        *ngFor="let m of chat"
        class="chat-message"
        [class.user]="m.from === 'user'"
        [class.bot]="m.from === 'bot'"
      >
        <span
          class="message-bubble inline-block px-3 py-1 rounded-lg"
          [class.user]="m.from === 'user'"
          [class.bot]="m.from === 'bot'"
        >
          {{ m.text }}
        </span>
      </div>
    </div>

    <!-- Input -->
    <form (submit)="sendMsg()" class="chat-input-form flex gap-2">
      <input
        matInput
        placeholder="ðŸ’¬ Escribe tu respuesta aquÃ­..."
        [(ngModel)]="chatInput"
        name="msg"
        class="flex-1 border rounded p-2"
      />
      <button
        mat-raised-button
        color="primary"
        type="submit"
        [disabled]="!chatInput.trim()"
      >
        <mat-icon>send</mat-icon>
      </button>
    </form>

    <!-- Feedback -->
    <div *ngIf="lastFeedback" class="feedback text-sm text-gray-500 mt-2">
      <mat-icon inline>info</mat-icon>
      <strong>Feedback:</strong> {{ lastFeedback }}
      <span *ngIf="lastScore !== null">
        â€“ PuntuaciÃ³n: {{ lastScore | number : "1.0-2" }}
      </span>
    </div>
  </mat-card>
</div>
<!-- /grid -->
<!-- 3â€‘b. Resultados (solo cuando existan) -->

<ng-container *ngIf="generatedCvText || generatedLetter">
  <div class="result-block">
    <!-- CV adaptado -->
    <mat-card
      #cvResult
      appearance="outlined"
      class="result-card"
      *ngIf="generatedCvText"
    >
      <h3 class="card-title">
        <mat-icon>article</mat-icon>
        CV adaptado
      </h3>
      <textarea readonly rows="12" class="w-full border rounded p-2">{{
        generatedCvText
      }}</textarea>
    </mat-card>

    <!-- Carta generada -->
    <mat-card
      #letterResult
      appearance="outlined"
      class="result-card"
      *ngIf="generatedLetter"
    >
      <h3 class="card-title">
        <mat-icon>article</mat-icon>
        Carta generada
      </h3>
      <textarea readonly rows="10" class="w-full border rounded p-2">{{
        generatedLetter
      }}</textarea>
    </mat-card>
  </div>
</ng-container>
